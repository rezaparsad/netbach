{% load static %}

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="twitter:card" content="summary_large_image">

    <meta name="twitter:site" content="@NetBach">
    <meta property="og:site_name" content="نت بچ">
    <meta name="twitter:creator" content="نت بچ">
    <title>ورود | نت بچ</title>

    <meta name="twitter:title" content="ورود | نت بچ">
    <meta name="description" content="ورود در سایت نت بچ لاگین در سایت نت بچ">
    <meta name="twitter:description" content="ورود در سایت نت بچ ریجیستر در سایت نت بچ">
    <meta property="og:description" content="ورود در سایت نت بچ ریجیستر در سایت نت بچ">
    <meta property="og:title" content="ورود | نت بچ">
    <meta property="og:locale" content="fa_IR">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    {% load static %}
    <link rel="canonical" href="{{ request.build_absolute_uri }}">
    <link rel="stylesheet" href="{% static 'css/bootstrap.rtl.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="icon" href="/static/icons/logo.png">
    <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Organization",
      "name" : "NetBach",
      "url" : "https://netbach.com",
      "sameAs" : [
        "https://instagram.com/NetBach",
        "https://youtube.com/@netbach",
        "https://telegram.me/netbach"
      ]
    }
    </script>
</head>
<body>
<section style="height: 75vh">
    <div class="container d-flex justify-content-center align-items-center h-100">
        <div class="card login-card p-3 rounded-4">
            <div class="card-body">
                <div class="d-flex justify-content-center">
                    <svg width="160" height="80" viewBox="0 0 160 80" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_5_3)">
                        <path d="M25.8828 51.258L5.75882 24.985C5.35749 24.469 4.97049 24.1393 4.59782 23.996C4.22515 23.824 3.68049 23.7093 2.96382 23.652C2.87782 23.3367 2.82049 23.007 2.79182 22.663C2.76315 22.319 2.74882 22.0323 2.74882 21.803C3.03549 21.8317 3.35082 21.8603 3.69482 21.889C4.06749 21.889 4.44015 21.9033 4.81282 21.932C5.21415 21.932 5.58682 21.932 5.93082 21.932C6.47549 21.932 6.99149 21.9177 7.47882 21.889C7.99482 21.8603 8.43915 21.8317 8.81182 21.803L25.9688 44.55L25.8828 51.258ZM2.74882 51.129C2.74882 50.7563 2.76315 50.4267 2.79182 50.14C2.82049 49.8247 2.87782 49.538 2.96382 49.28C3.73782 49.28 4.33982 49.0937 4.76982 48.721C5.19982 48.3483 5.50082 47.7033 5.67282 46.786C5.84482 45.84 5.93082 44.5643 5.93082 42.959V24.77H8.12382V42.959C8.12382 44.5643 8.20982 45.84 8.38182 46.786C8.55382 47.7033 8.85482 48.3483 9.28482 48.721C9.71482 49.0937 10.3168 49.28 11.0908 49.28C11.1768 49.538 11.2342 49.8103 11.2628 50.097C11.2915 50.3837 11.3058 50.7277 11.3058 51.129C10.8758 51.1003 10.4028 51.0717 9.88682 51.043C9.39949 51.043 8.91215 51.0287 8.42482 51C7.93749 51 7.47882 51 7.04882 51C6.64749 51 6.17449 51 5.62982 51C5.08515 51.0287 4.55482 51.043 4.03882 51.043C3.55149 51.0717 3.12149 51.1003 2.74882 51.129ZM25.8828 51.258L25.5388 46.958V29.758C25.5388 28.1813 25.4528 26.963 25.2808 26.103C25.1088 25.2143 24.8078 24.5837 24.3778 24.211C23.9478 23.8383 23.3458 23.652 22.5718 23.652C22.4858 23.1647 22.4285 22.8063 22.3998 22.577C22.3712 22.319 22.3568 22.061 22.3568 21.803C22.7868 21.8317 23.2312 21.8603 23.6898 21.889C24.1485 21.889 24.6072 21.9033 25.0658 21.932C25.5532 21.932 25.9975 21.932 26.3988 21.932C27.0008 21.932 27.6888 21.9177 28.4628 21.889C29.2368 21.8603 29.9105 21.8317 30.4838 21.803C30.4838 22.0897 30.4695 22.3907 30.4408 22.706C30.4122 23.0213 30.3548 23.3367 30.2688 23.652C29.6382 23.652 29.1365 23.8383 28.7638 24.211C28.3912 24.5837 28.1188 25.2143 27.9468 26.103C27.8035 26.963 27.7318 28.1813 27.7318 29.758V51C27.5025 51.086 27.2158 51.1433 26.8718 51.172C26.5278 51.2293 26.1982 51.258 25.8828 51.258ZM43.0909 51.387C41.0555 51.387 39.3642 50.9283 38.0169 50.011C36.6695 49.0937 35.6519 47.861 34.9639 46.313C34.3045 44.7363 33.9749 43.0163 33.9749 41.153C33.9749 39.3183 34.3332 37.627 35.0499 36.079C35.7665 34.531 36.7842 33.284 38.1029 32.338C39.4502 31.392 41.0412 30.919 42.8759 30.919C44.7392 30.919 46.2299 31.3203 47.3479 32.123C48.4946 32.9257 49.3402 34.0007 49.8849 35.348C50.4582 36.6953 50.8022 38.186 50.9169 39.82C50.8022 40.3933 50.5872 40.8807 50.2719 41.282C49.7846 41.282 49.0536 41.282 48.0789 41.282C47.1042 41.282 46.0006 41.2963 44.7679 41.325C43.5352 41.325 42.2739 41.3537 40.9839 41.411C39.6939 41.4397 38.4755 41.4827 37.3289 41.54V39.347H46.4449C46.4449 37.455 46.1009 35.9213 45.4129 34.746C44.7249 33.5707 43.7502 32.983 42.4889 32.983C41.8009 32.983 41.1272 33.198 40.4679 33.628C39.8086 34.0293 39.2639 34.7603 38.8339 35.821C38.4039 36.853 38.1889 38.3293 38.1889 40.25C38.1889 41.6547 38.3609 43.0307 38.7049 44.378C39.0775 45.6967 39.7082 46.8003 40.5969 47.689C41.5142 48.549 42.8042 48.979 44.4669 48.979C45.4129 48.979 46.3445 48.764 47.2619 48.334C48.1792 47.904 48.9962 47.2877 49.7129 46.485C49.9422 46.5997 50.1572 46.8003 50.3579 47.087C50.5872 47.345 50.7162 47.5887 50.7449 47.818C49.7702 49.108 48.6379 50.0253 47.3479 50.57C46.0865 51.1147 44.6675 51.387 43.0909 51.387ZM61.5651 51.387C59.8738 51.387 58.6124 50.957 57.7811 50.097C56.9784 49.2083 56.5771 47.7893 56.5771 45.84V34.187C56.1471 34.0437 55.7028 33.929 55.2441 33.843C54.7854 33.7283 54.1978 33.6567 53.4811 33.628C53.4811 33.2553 53.5098 32.94 53.5671 32.682C53.6244 32.3953 53.7248 32.08 53.8681 31.736H56.5771V26.06C57.1504 25.9167 57.7094 25.6873 58.2541 25.372C58.8274 25.0567 59.3291 24.7127 59.7591 24.34C60.0458 24.4547 60.2321 24.6267 60.3181 24.856C60.4041 25.0853 60.4471 25.6587 60.4471 26.576V31.736H66.0371C66.0371 32.0227 66.0084 32.338 65.9511 32.682C65.8938 32.9973 65.7934 33.3127 65.6501 33.628C64.6181 33.6567 63.6721 33.7283 62.8121 33.843C61.9521 33.929 61.1638 34.0437 60.4471 34.187V44.937C60.4471 45.883 60.5474 46.6713 60.7481 47.302C60.9488 47.904 61.2354 48.3483 61.6081 48.635C61.9808 48.9217 62.4251 49.065 62.9411 49.065C63.5431 49.065 64.0591 48.979 64.4891 48.807C64.9478 48.635 65.3778 48.377 65.7791 48.033C66.1518 48.463 66.3668 48.936 66.4241 49.452C65.9654 49.9967 65.2631 50.4553 64.3171 50.828C63.3998 51.2007 62.4824 51.387 61.5651 51.387Z" fill="#007FFF"></path>
                        <path d="M70.1473 21.803C70.7206 21.8317 71.4086 21.8603 72.2113 21.889C73.0426 21.9177 73.8453 21.932 74.6193 21.932C75.3073 21.932 75.9953 21.932 76.6833 21.932C77.3713 21.9033 78.0593 21.889 78.7473 21.889C79.4353 21.8603 80.109 21.846 80.7683 21.846C82.431 21.846 83.9503 22.018 85.3263 22.362C86.7023 22.706 87.806 23.3367 88.6373 24.254C89.4973 25.1427 89.9273 26.4327 89.9273 28.124C89.9273 29.9587 89.3683 31.5353 88.2503 32.854C87.1323 34.144 85.613 34.9323 83.6923 35.219C85.2116 35.305 86.602 35.5917 87.8633 36.079C89.1533 36.5377 90.1853 37.283 90.9593 38.315C91.7333 39.347 92.1203 40.7517 92.1203 42.529C92.1203 44.077 91.762 45.496 91.0453 46.786C90.3573 48.076 89.2536 49.108 87.7343 49.882C86.215 50.6273 84.237 51 81.8003 51C80.9976 51 80.0373 51 78.9193 51C77.83 51 76.712 51 75.5653 51C74.4186 51.0287 73.358 51.043 72.3833 51.043C71.4086 51.0717 70.649 51.1003 70.1043 51.129C70.1043 50.7277 70.1186 50.3837 70.1473 50.097C70.176 49.7817 70.2333 49.5093 70.3193 49.28C71.0933 49.2227 71.6953 49.0793 72.1253 48.85C72.5553 48.6207 72.8563 48.2193 73.0283 47.646C73.229 47.044 73.3293 46.184 73.3293 45.066V27.393C73.3293 26.4183 73.2433 25.673 73.0713 25.157C72.8993 24.641 72.5983 24.2683 72.1683 24.039C71.7383 23.8097 71.1363 23.6807 70.3623 23.652C70.2763 23.4227 70.219 23.1503 70.1903 22.835C70.1616 22.491 70.1473 22.147 70.1473 21.803ZM77.3713 23.437V45.066C77.3713 46.2413 77.4716 47.13 77.6723 47.732C77.9016 48.3053 78.303 48.6923 78.8763 48.893C79.4783 49.065 80.3096 49.151 81.3703 49.151C83.4916 49.151 85.0396 48.6207 86.0143 47.56C87.0176 46.4707 87.5193 44.9943 87.5193 43.131C87.5193 41.7837 87.247 40.6943 86.7023 39.863C86.1576 39.003 85.4266 38.358 84.5093 37.928C83.6206 37.4693 82.6316 37.154 81.5423 36.982C80.4816 36.81 79.421 36.724 78.3603 36.724H76.8553V34.875H78.7043C80.5676 34.875 81.9866 34.617 82.9613 34.101C83.936 33.585 84.6096 32.9113 84.9823 32.08C85.355 31.22 85.5413 30.3313 85.5413 29.414C85.5413 27.9233 85.1973 26.7767 84.5093 25.974C83.85 25.1427 83.0186 24.5693 82.0153 24.254C81.0406 23.91 80.0803 23.738 79.1343 23.738C78.7616 23.738 78.389 23.7667 78.0163 23.824C77.6723 23.8527 77.2566 23.9387 76.7693 24.082L77.3713 23.437ZM109.236 51.387C108.921 51.2437 108.663 50.9857 108.462 50.613C108.29 50.2403 108.204 49.6527 108.204 48.85C108.204 48.592 108.219 48.291 108.247 47.947C108.276 47.5743 108.333 47.2447 108.419 46.958H108.505C108.419 47.4167 108.219 47.9183 107.903 48.463C107.617 48.979 107.23 49.4377 106.742 49.839C106.255 50.269 105.639 50.6273 104.893 50.914C104.148 51.172 103.245 51.301 102.184 51.301C100.378 51.301 99.0023 50.8997 98.0563 50.097C97.1103 49.2657 96.6373 48.1477 96.6373 46.743C96.6373 45.625 96.8953 44.679 97.4113 43.905C97.956 43.1023 98.644 42.443 99.4753 41.927C100.335 41.3823 101.253 40.9523 102.227 40.637C103.231 40.3217 104.205 40.078 105.151 39.906C106.097 39.734 106.929 39.5907 107.645 39.476C107.645 38.3007 107.617 37.3833 107.559 36.724C107.531 36.0647 107.445 35.5487 107.301 35.176C107.187 34.7747 107 34.4307 106.742 34.144C106.398 33.714 105.997 33.3987 105.538 33.198C105.108 32.9687 104.621 32.854 104.076 32.854C103.13 32.854 102.385 33.155 101.84 33.757C101.296 34.3303 100.909 35.004 100.679 35.778C100.45 36.552 100.321 37.24 100.292 37.842C99.977 37.842 99.5756 37.8277 99.0883 37.799C98.6296 37.7417 98.2856 37.6557 98.0563 37.541C98.1136 36.8243 98.128 36.0217 98.0993 35.133C98.0706 34.2443 97.9846 33.4847 97.8413 32.854C99.0166 32.252 100.249 31.779 101.539 31.435C102.858 31.091 104.062 30.919 105.151 30.919C106.212 30.919 107.115 31.0767 107.86 31.392C108.634 31.6787 109.251 32.0657 109.709 32.553C110.455 33.2697 110.942 34.2157 111.171 35.391C111.401 36.5377 111.515 38.0713 111.515 39.992V44.722C111.515 45.5247 111.573 46.1697 111.687 46.657C111.831 47.1157 112.089 47.4597 112.461 47.689C112.834 47.8897 113.407 48.0187 114.181 48.076C114.181 48.3627 114.167 48.6923 114.138 49.065C114.11 49.409 114.038 49.7387 113.923 50.054C113.207 50.0827 112.404 50.226 111.515 50.484C110.655 50.7133 109.896 51.0143 109.236 51.387ZM103.388 48.936C104.019 48.936 104.664 48.7353 105.323 48.334C105.983 47.904 106.527 47.2447 106.957 46.356C107.416 45.4673 107.645 44.3063 107.645 42.873V41.239C106.929 41.325 106.169 41.454 105.366 41.626C104.564 41.7693 103.818 41.9987 103.13 42.314C102.442 42.6293 101.883 43.0737 101.453 43.647C101.023 44.1917 100.808 44.937 100.808 45.883C100.808 46.9437 101.066 47.7177 101.582 48.205C102.098 48.6923 102.7 48.936 103.388 48.936ZM133.619 47.646C132.845 48.8787 131.885 49.8103 130.738 50.441C129.592 51.0717 128.201 51.387 126.567 51.387C125.105 51.387 123.686 51.0143 122.31 50.269C120.963 49.495 119.845 48.3627 118.956 46.872C118.068 45.3527 117.623 43.475 117.623 41.239C117.623 39.519 117.967 37.8707 118.655 36.294C119.343 34.7173 120.347 33.4273 121.665 32.424C123.013 31.4207 124.647 30.919 126.567 30.919C127.886 30.919 129.09 31.0767 130.179 31.392C131.297 31.7073 132.258 32.1947 133.06 32.854C132.946 33.6853 132.86 34.5023 132.802 35.305C132.774 36.1077 132.759 36.9247 132.759 37.756C132.53 37.8707 132.215 37.9567 131.813 38.014C131.441 38.0713 131.097 38.1 130.781 38.1C130.609 36.4373 130.122 35.1617 129.319 34.273C128.517 33.3843 127.485 32.94 126.223 32.94C124.819 32.94 123.701 33.5993 122.869 34.918C122.038 36.2367 121.622 38.1287 121.622 40.594C121.622 42.0273 121.852 43.389 122.31 44.679C122.798 45.9403 123.5 46.9723 124.417 47.775C125.335 48.549 126.453 48.936 127.771 48.936C128.689 48.936 129.549 48.721 130.351 48.291C131.183 47.861 131.914 47.2447 132.544 46.442C132.774 46.5567 132.989 46.7287 133.189 46.958C133.39 47.1587 133.533 47.388 133.619 47.646ZM155.372 45.539C155.372 47.0297 155.573 48.033 155.974 48.549C156.404 49.0363 157.049 49.28 157.909 49.28C157.995 49.538 158.052 49.8103 158.081 50.097C158.11 50.3837 158.124 50.7277 158.124 51.129C157.493 51.0717 156.777 51.0287 155.974 51C155.171 51 154.326 51 153.437 51C152.864 51 152.262 51 151.631 51C151 51.0287 150.398 51.043 149.825 51.043C149.28 51.0717 148.779 51.1003 148.32 51.129C148.32 50.7277 148.334 50.3837 148.363 50.097C148.392 49.7817 148.449 49.5093 148.535 49.28C149.567 49.28 150.312 49.022 150.771 48.506C151.258 47.9613 151.502 46.9723 151.502 45.539V39.003C151.502 36.9677 151.129 35.5917 150.384 34.875C149.639 34.1297 148.678 33.757 147.503 33.757C146.758 33.757 146.012 34.0007 145.267 34.488C144.522 34.9467 143.891 35.7063 143.375 36.767C142.888 37.799 142.644 39.1893 142.644 40.938V45.539C142.644 46.9723 142.859 47.9613 143.289 48.506C143.719 49.022 144.493 49.28 145.611 49.28C145.697 49.538 145.754 49.8103 145.783 50.097C145.812 50.3837 145.826 50.7277 145.826 51.129C145.425 51.1003 144.937 51.0717 144.364 51.043C143.791 51.043 143.189 51.0287 142.558 51C141.927 51 141.311 51 140.709 51C140.136 51 139.534 51 138.903 51C138.272 51.0287 137.67 51.043 137.097 51.043C136.524 51.0717 136.022 51.1003 135.592 51.129C135.592 50.7277 135.606 50.3837 135.635 50.097C135.664 49.7817 135.721 49.5093 135.807 49.28C136.925 49.28 137.699 49.022 138.129 48.506C138.559 47.9613 138.774 46.9723 138.774 45.539V37.025L142.644 32.811C142.644 33.155 142.63 33.542 142.601 33.972C142.572 34.402 142.486 34.8607 142.343 35.348C142.429 35.2047 142.515 35.047 142.601 34.875C142.687 34.6743 142.816 34.4593 142.988 34.23C143.475 33.5707 144.249 32.897 145.31 32.209C146.399 31.4923 147.704 31.134 149.223 31.134C150.312 31.134 151.316 31.3633 152.233 31.822C153.179 32.252 153.939 32.983 154.512 34.015C155.085 35.0183 155.372 36.3943 155.372 38.143V45.539ZM138.774 26.275C138.774 25.587 138.702 25.028 138.559 24.598C138.444 24.1393 138.158 23.7953 137.699 23.566C137.24 23.3367 136.524 23.222 135.549 23.222C135.549 22.9067 135.578 22.62 135.635 22.362C135.692 22.104 135.793 21.8603 135.936 21.631C136.366 21.631 136.968 21.5593 137.742 21.416C138.545 21.2727 139.319 21.0863 140.064 20.857C140.809 20.6277 141.354 20.3983 141.698 20.169C141.956 20.255 142.171 20.427 142.343 20.685C142.544 20.943 142.644 21.3443 142.644 21.889V27.866H138.774V26.275ZM138.774 26.275H142.644V32.811L138.774 37.67V26.275Z" fill="#292929"></path>
                        </g>
                        <defs>
                        <clipPath id="clip0_5_3">
                        <rect width="160" height="80" fill="white"></rect>
                        </clipPath>
                        </defs>
                    </svg>
                </div>
                <div>
                    <h1 id="title-card" class="mt-3 mb-4" style="font-size: 20px; font-weight: bold">ورود | ثبت نام</h1>
                    <p class="text-natural description-card mb-0">سلام !</p>
                    <p class="text-natural description-card">شماره موبایل خود را وارد کنید</p>
                    <input id="input-phone" class="form-control p-2" type="text">
                    <p id="error-field" class="mt-2 text-primary text-natural"></p>
                    <div class="d-flex flex-column mt-3">
                        <button id="button-login" class="btn bg-primary py-2" style="color: white">
                            <span id="button-text">ورود</span>
                            <div class="d-none spinner-border spinner-border-sm" role="status"
                                 id="spinner-loading">
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<script>
    const getCookie = (name) => {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    var titleCard = document.querySelector("#title-card")
    var descriptionCard = document.querySelectorAll(".description-card")
    var buttonText = document.querySelector("#button-text")
    var errorField = document.querySelector("#error-field")
    var inputPhone = document.querySelector("#input-phone")
    var buttonLogin = document.querySelector("#button-login")
    var spinner = document.querySelector("#spinner-loading")
    const csrfToken = getCookie('csrftoken');
    var regex_phone = /^[0-9۰-۹][0-9۰-۹]{9,11}$/
    var regex_code = /^[0-9۰-۹]{5}$/

    window.onpopstate = function () {
        window.history.replaceState("phone", window.location.href)
        location.reload()
    }

    async function sendPhone(phone, hashId) {
        let response = await fetch(`{{ PANEL_URL }}accounts/send-phone/`, {
            method: "POST",
            credentials: 'include',
            headers: {"X-CSRFToken": csrfToken},
            body: JSON.stringify({"phone": phone, "hash_id": hashId})
        })
        return await response.json()
    }

    async function sendCode(phone, code, hashId) {
        let response = await fetch(`{{ PANEL_URL }}accounts/send-code/`, {
            method: "POST",
            credentials: 'include',
            headers: {"X-CSRFToken": csrfToken},
            body: JSON.stringify({"phone": phone, "code": code, "hash_id": hashId})
        })
        return await response.json()
    }

    function errorShape(message) {
        errorField.innerText = message
        errorField.classList.remove("d-none")
        buttonLogin.firstElementChild.classList.remove("d-none")
        buttonLogin.disabled = false
        spinner.classList.add("d-none")
    }

    function sentCodeShape(message) {
        window.history.pushState("code", null, window.location.href)
        inputPhone.focus();
        inputPhone.value = null
        titleCard.innerText = "کد تایید را وارد کنید"
        descriptionCard[0].classList.add("d-none")
        descriptionCard[1].innerText = message
        spinner.classList.add("d-none")
        buttonText.innerText = "تایید"
        buttonText.classList.remove("d-none")
    }

    verifyPhone = (number) => {
        if (number.startsWith("0"))
            number = number.substring(1)
        else if (number.startsWith("98"))
            number = number.substring(2)
        else if (!number.startsWith("9"))
            return false
        if (number.length !== 10)
            return false
        return number
    }

    function checkDigit(number) {
        const faDigits = {
            "۱": "1",
            "۲": "2",
            "۳": "3",
            "۴": "4",
            "۵": "5",
            "۶": "6",
            "۷": "7",
            "۸": "8",
            "۹": "9",
            "۰": "0"
        }
        var newNumber = ""
        for (let i = 0; i < number.length; i++) {
            let char = number[i]
            if (Object.keys(faDigits).includes(char)) {
                newNumber += faDigits[char]
            } else {
                newNumber += char
            }
        }
        return newNumber
    }

    function checkPhoneNumber() {
        errorField.classList.add("d-none")
        buttonLogin.firstElementChild.classList.add("d-none")
        buttonLogin.disabled = true
        spinner.classList.remove("d-none")
        let phone = inputPhone.value
        if (regex_phone.test(phone) && verifyPhone(checkDigit(phone))) {
            phone = verifyPhone(checkDigit(phone))
            let hash_id = window.sessionStorage.getItem("hashId" + phone)
            sendPhone(phone, hash_id).then(response => {
                let message = response["message"]
                buttonLogin.disabled = false
                if (response["response"] === true) {
                    window.sessionStorage.setItem("phone", phone)
                    window.sessionStorage.setItem("hashId" + phone, response["hash_id"])
                    sentCodeShape(message)
                } else {
                    errorShape(message)
                }
            }).catch(() => errorShape("خطا در بررسی اطلاعات"))
        } else {
            errorField.innerText = "شماره موبایل اشتباه است"
            errorField.classList.remove("d-none")
            buttonLogin.firstElementChild.classList.remove("d-none")
            buttonLogin.disabled = false
            spinner.classList.add("d-none")
        }
    }

    function checkCode() {
        errorField.classList.add("d-none")
        buttonLogin.firstElementChild.classList.add("d-none")
        buttonLogin.disabled = true
        spinner.classList.remove("d-none")
        let code = inputPhone.value
        if (regex_code.test(code)) {
            let phone = window.sessionStorage.getItem("phone")
            let hashId = window.sessionStorage.getItem("hashId" + phone)
            sendCode(phone, checkDigit(code), hashId).then(response => {
                buttonLogin.disabled = false
                let message = response["message"]
                if (response["response"] === true) {
                    window.location.replace(response["next"])
                } else {
                    errorShape(message)
                }
            }).catch(() => errorShape("خطا در بررسی اطلاعات"))
        } else {
            errorField.innerText = "کد اشتباه است"
            errorField.classList.remove("d-none")
            buttonLogin.firstElementChild.classList.remove("d-none")
            buttonLogin.disabled = false
            spinner.classList.add("d-none")
        }
    }

    buttonLogin.addEventListener("click", () => {
        if (window.history.state === "code") {
            checkCode()
        } else {
            checkPhoneNumber()
        }
    })

    inputPhone.addEventListener("keypress", (event) => {
        if (event.key === "Enter") {
            event.preventDefault()
            if (window.history.state === "code") {
                checkCode()
            } else {
                checkPhoneNumber()
            }
        }
    })

    window.onload = function() {
        inputPhone.focus();
    }
</script>
</body>
</html>